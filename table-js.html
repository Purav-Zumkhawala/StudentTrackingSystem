<script>
  var url = "https://docs.google.com/spreadsheets/d/1cZ1w8UhgEZ36iztyYdYEU6c6VVQJHMi9cnIb7Uq3eoU/edit#gid=0";
  var index = 0;
  
  document.addEventListener("DOMContentLoaded", function(){
    google.script.run.withSuccessHandler(generate_table).importCSVFromGoogleDrive(url, index);
  });
  
  var switch_button = document.getElementById("switch_table");
  
//  switch_button.textContent = google.script.run.getSheetNames(url)[index];
//  console.log("the sheet name");
//  var names = google.script.run.getSheetNames(url);
//  console.log(names[1]);
  switch_button.addEventListener("click", function(){
    document.getElementById("table").innerHTML = "";
    index += 1;
    if(index >= 2){
      index = 0;
    }
    google.script.run.withSuccessHandler(generate_table).importCSVFromGoogleDrive(url, index);
  });

  function generate_table(data){
    var table_div = document.getElementById("tb");
    
    var table = document.getElementById("table");
    
    var table_header_row = document.createElement("tr");
    table_header_row.setAttribute("class", "thead-light");
    
    for(var i = 0; i < data[0].length; i++){
      var header = document.createElement("th");
      header.textContent = data[0][i];
      table_header_row.appendChild(header);
    }
    
    table.appendChild(table_header_row);
    
    var num_rows = data.length;
    
    var data_header = data[0];
    
    var possiblepdf = ["DocumentLink","DocumentLink"]
    
    data.splice(0, 1);
  
    data.forEach(function(rows){
      var row = document.createElement("tr");
      row.onmouseover = function() {
        this.style.backgroundColor = "#f5f5f5";
      }
      row.onmouseout = function() {
        this.style.backgroundColor = "#fff";  
      }

      var modal = document.getElementById("myModal");
      
      var modal_content = document.getElementById("modal-content");
      
      row.addEventListener("click", function(){
        for(var i = 0; i < data[0].length; i++){
          var h = document.createElement("H3");
          h.style.textAlign = "center";
          var t = document.createTextNode(data_header[i] + ":   " + rows[i]);
          h.appendChild(t);
          modal_content.appendChild(h);
        }
        
        modal.style.display = "block";
      });
      
      var span = document.getElementsByClassName("close")[0];
      span.onclick = function() {
        modal.style.display = "none";
        modal_content.innerHTML = "";
      }
      
      window.onclick = function(event) {
        if (event.target == modal) {
          modal.style.display = "none";
          modal_content.innerHTML = "";
        }       
      }
      
      for(var i = 0; i < data[0].length; i++){
        var table_data = document.createElement("td");
        if(possiblepdf.includes(data_header[i]) && rows[i]!="NA"){
          table_data.innerHTML = '<a href="' + rows[i] + '">' + "Link" + '</a>';
        }
        else{
          table_data.textContent = rows[i];
        }
        row.appendChild(table_data);
        
      }
      table.appendChild(row);
      
    });
    
    table.setAttribute("class", "table table-bordered");
  }
  

</script>
